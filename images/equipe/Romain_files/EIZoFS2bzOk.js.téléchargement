if (self.CavalryLogger) { CavalryLogger.start_js(["Sak5+"]); }

__d("PinnedConversationNubsActionTaken",[],(function(a,b,c,d,e,f){e.exports={TAB_CLOSED_BY_USER:0}}),null);
__d("ConversationNubAddTabSource",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({NOTIFICATION:"notification",PAGE_REFRESH:"page_refresh",USER_PIN:"user_pin",UNSEEN_NOTIFICATION:"unseen_notification",UNKNOWN:"unknown"})}),null);
__d("ConversationNubTabStateListStorage",[],(function(a,b,c,d,e,f){"use strict";function a(){this.$1=[]}a.prototype.modify=function(a){this.$1=a(this.$1)};a.prototype.getData=function(){return this.$1};e.exports=a}),null);
__d("differenceSets",["filterSet"],(function(a,b,c,d,e,f){"use strict";function a(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("filterSet")(a,function(a){return!d.some(function(b){return b.has(a)})})}e.exports=a}),null);
__d("ConversationNubTabStateList",["invariant","ConversationNubTabStateListStorage","differenceSets"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(){this.$2=new Set(),this.$1=new(b("ConversationNubTabStateListStorage"))()}a.prototype.modifyTabState=function(a,b){this.modifyTabs(function(c){var d=c.findIndex(function(b){return b.tabID===a});d!==-1||g(0,5816);b(c[d]);return c})};a.prototype.$3=function(a){return new Set(a.map(function(a){return a.tabID}))};a.prototype.modifyTabs=function(a){try{this.$1.modify(function(c){var d=this.$3(c);c=a(c);var e=this.$3(c);this.$2=b("differenceSets")(d,e);return c}.bind(this))}finally{this.$2=new Set()}};a.prototype.getTabs=function(){return this.$1.getData()};a.prototype.getTabState=function(a){a=this.getTabStateIfExists(a);a||g(0,5816);return a};a.prototype.getTabStateIfExists=function(a){return this.getTabs().find(function(b){return b.tabID===a})};a.prototype.push=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];this.modifyTabs(function(a){b.forEach(function(b){a.find(function(a){return a.tabID===b.tabID})?g(0,5817,b.tabID):a.push(b)});return a})};a.prototype.remove=function(a){this.modifyTabs(function(b){var c=b.findIndex(function(b){return b.tabID===a});c!==-1&&b.splice(c,1);return b})};e.exports=a}),null);
__d("ConversationNubTabState",["invariant","ConversationNubTabStateList"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=12;function a(){this.$1=Object.create(null),this.$2=new(b("ConversationNubTabStateList"))(),this.$3=Infinity}a.prototype.anyTabHasFocus=function(){return this.getUnsortedLoadedTabs().some(function(a){return a.getIsFocused()})};a.prototype.anyTabHasText=function(){return this.getUnsortedLoadedTabs().some(function(a){return a.getHasText()})};a.prototype.getTabState=function(a){return this.$2.getTabState(a)};a.prototype.getTabStateIfExists=function(a){return this.$2.getTabStateIfExists(a)};a.prototype.getUnloadedTabs=function(){var a=this.$2.getTabs().filter(function(a){return!this.getLoadedTab(a.tabID)}.bind(this));return a};a.prototype.setMaxDockTabs=function(a){this.$3=a};a.prototype.getNumDockTabs=function(){var a=this.$3,b=this.getTotalTabCount();return Math.min(a,b)};a.prototype.getNumMenuTabs=function(){return this.getTotalTabCount()-this.getNumDockTabs()};a.prototype.addTabState=function(a){this.$2.push(a)};a.prototype.addLoadedTab=function(a,b){var c=this.getTabState(a);if(!c)return;c=this.getLoadedTab(a);if(c)return;this.$1[a]=b;this.$4()};a.prototype.getLoadedTab=function(a){return this.$1[a]};a.prototype.getLoadedTabByFeedbackTarget=function(a){return this.getLoadedTabs().find(function(b){return b.getPersistentState().ftID===a})};a.prototype.isTabInDock=function(a){a=this.getLoadedTab(a);if(!a)return!1;a=this.$5(a);return 0<=a&&a<this.getNumDockTabs()};a.prototype.clearTabNotifications=function(a){this.$2.modifyTabState(a,function(a){a.unseenCommentsSinceLastCleared={},a.hasFakeInitBadge=!1,a.badgeCount=0,a.isBlinkingUnread=!1})};a.prototype.deleteTab=function(a){var b=this.getLoadedTab(a);b&&(delete this.$1[a],b.destroy());this.$2.remove(a);return Boolean(b)};a.prototype.deleteAllTabs=function(){this.getUnsortedLoadedTabs().forEach(function(a){return this.deleteTab(a.getTabID())}.bind(this))};a.prototype.modifyTabState=function(a,b){return this.$2.modifyTabState(a,b)};a.prototype.moveTabToDockLeft=function(a){__p&&__p();var b=this.getLoadedTab(a);if(!b)return;this.$2.modifyTabs(function(c){__p&&__p();var d=c.findIndex(function(b){return b.tabID===a});d!==-1||g(0,5816);var e=c[d],f=this.$5(b),h=this.getLoadedTabs().length,i=this.getNumDockTabs();if(f<0||h===0)return c;else if(i===0){f!==0&&(c.splice(d,1),c.unshift(e));return c}h=i-1;if(f===h)return c;c.splice(d,1);f<h&&(h-=1);i=this.getLoadedTabs()[h];var j=this.getTabState(i.getTabID());j||g(0,6150);d=c.findIndex(function(a){return a.tabID===j.tabID});c.splice(d,0,e);return c}.bind(this))};a.prototype.getLoadedTabs=function(){var a=this.$2.getTabs().map(function(a){return this.getLoadedTab(a.tabID)}.bind(this)).filter(Boolean);return a};a.prototype.getUnsortedLoadedTabs=function(){var a=Object.values(this.$1);return a};a.prototype.getTotalTabCount=function(){return this.getUnsortedLoadedTabs().length};a.prototype.getTabsForDockOldestFirst=function(){return this.getLoadedTabs().slice(0,this.getNumDockTabs())};a.prototype.getTabsForDockNewestFirst=function(){return this.getTabsForDockOldestFirst().slice().reverse()};a.prototype.getTabsForMenuOldestFirst=function(){return this.getLoadedTabs().slice(this.getNumDockTabs())};a.prototype.getTabsForMenuNewestFirst=function(){return this.getLoadedTabs().slice(this.getNumDockTabs()).reverse()};a.prototype.$4=function(){var a=this.getLoadedTabs().length;if(a>h){a=a-h;a=this.getTabsForMenuOldestFirst().slice(0,a);a.map(function(a){return a.getTabID()}).forEach(function(a){return this.deleteTab(a)}.bind(this))}};a.prototype.$5=function(a){return this.getLoadedTabs().indexOf(a)};e.exports=new a()}),null);
__d("ConversationNub",["csx","cx","Arbiter","ConversationNubHeader","ConversationNubTabState","ConversationNubTabsUpdateEventController","ConversationNubUtils","CSS","DOM","EventListener","NotificationUserActions","SubscriptionsHandler","UFIComposerIsTypingStore","URI","containsNode","debounce","guid"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=b("ConversationNubTabsUpdateEventController").minimizeAndInformTabUpdate,j=b("ConversationNubTabsUpdateEventController").popOutAndInformTabUpdate,k=b("ConversationNubTabState"),l=10,m=500,n=100;a.createDefaultState=function(a,c,d,e,f,g){return{tabID:a,permalinkURI:c?new(b("URI"))(c):null,ftID:d,notifAlertID:e,notificationType:f,title:g,keepAtBottom:!1,isTabRaised:!1,isBlinkingUnread:!1,badgeCount:0,allSeenNewComments:{},unseenCommentsSinceLastCleared:{},hasFakeInitBadge:!1}};function a(a,c,d,e,f,g){f===void 0&&(f=!1),g===void 0&&(g=!1),this.$13=!1,this.$14=!1,this.$1=a,this.$12=c,this.$5=b("guid")(),this.$7=null,this.$8=!1,this.$9=null,this.$10=f,this.$11=g,this.$15=e,this.$6=new(b("SubscriptionsHandler"))(),this.$16(),this.$17(),d!=null&&k.modifyTabState(this.$12,function(a){d?a.hasFakeInitBadge=!1:(a.hasFakeInitBadge=!0,this.$18(1),this.$19(!0))}.bind(this)),this.$20()}a.prototype.$20=function(){this.$21(),this.$22(),b("ConversationNubUtils").informShouldRecheckTabVisibility(this),this.forceReflow()};a.prototype.getPersistentState=function(){return k.getTabState(this.$12)};a.prototype.getPersistentStateIfExists=function(){return k.getTabStateIfExists(this.$12)};a.prototype.$16=function(){__p&&__p();var a=this.$23();if(a){this.$6.addSubscriptions(b("EventListener").listen(a,"click",this.$24.bind(this)),b("EventListener").listen(a,"mouseenter",this.$25.bind(this)),b("EventListener").listen(a,"mouseleave",this.$26.bind(this)));a=b("ConversationNubUtils").getCloseButtonElem(a);a&&b("ConversationNubUtils").addCloseButtonListeners(a,this.$6,this.$27.bind(this))}a=this.$28();a&&(k.modifyTabState(this.$12,function(a){a.keepAtBottom=!0}),this.$6.addSubscriptions(b("EventListener").listen(a,"scroll",b("debounce")(this.$29.bind(this),n)),b("Arbiter").subscribe("reflow",this.$30.bind(this))));a=this.$31();a&&this.$6.addSubscriptions(b("EventListener").listen(a,"focusin",this.$32.bind(this,!0)),b("EventListener").listen(a,"focusout",this.$32.bind(this,!1)))};a.prototype.$17=function(){__p&&__p();var a=this.$33();if(!a){this.$2=null;return}var c=function(){var a=this.getPersistentState();return{permalinkURI:a.permalinkURI,ftID:a.ftID,tabID:a.tabID}}.bind(this);a=new(b("ConversationNubHeader"))(a,c);this.$6.addSubscriptions(a.subscribe("closeButton",this.$27.bind(this)),a.subscribe("showMenu",this.$34.bind(this)),a.subscribe("hideMenu",this.$35.bind(this)),a.subscribe("minimizeButton",this.$36.bind(this,!0)),a.subscribe("clickHeader",this.$36.bind(this,!0)),a.subscribe("menuPermalinkClick",this.$36.bind(this,!1)),b("UFIComposerIsTypingStore").addListener(function(){var a=this.getPersistentStateIfExists();if(!a)return;var c=this.$14;a=b("UFIComposerIsTypingStore").getValueFor(a.ftID);this.$14=a===!0;c!==this.$14&&b("ConversationNubTabsUpdateEventController").informTabsUpdated()}.bind(this)));this.$2=a};a.prototype.$33=function(){return this.$1&&b("DOM").scry(this.$1,".fbNubFlyoutTitlebar")[0]};a.prototype.$23=function(){return this.$1&&b("DOM").scry(this.$1,".fbNubButton")[0]};a.prototype.$28=function(){!this.$3&&this.$1&&(this.$3=b("DOM").scry(this.$1,".uiScrollableAreaWrap")[0]);return this.$3};a.prototype.$31=function(){!this.$4&&this.$1&&(this.$4=b("DOM").scry(this.$1,".fbNubFlyoutBodyContent")[0]);return this.$4};a.prototype.$37=function(){var a=this.$23();return a?b("DOM").scry(a,"._37op")[0]:null};a.prototype.$27=function(){b("ConversationNubUtils").informShouldCloseTab(this.$12,this.getFeedbackTargetID(),b("ConversationNubUtils").CLOSE_REASON_TAB_X_OUT)};a.prototype.$36=function(a){i(this,a)};a.prototype.$34=function(){this.$1&&b("CSS").addClass(this.$1,"_1uw3")};a.prototype.$35=function(){this.$1&&b("CSS").removeClass(this.$1,"_1uw3")};a.prototype.$24=function(){this.getPersistentState().isTabRaised?i(this,!0):j(this,!0)};a.prototype.$25=function(){this.getPersistentState().isBlinkingUnread&&(this.$9=new Date())};a.prototype.$26=function(){var a=this.$9;if(a&&this.getPersistentState().isBlinkingUnread){var b=new Date();b-a>=m&&this.$19(!1)}this.$9=null};a.prototype.$38=function(){var a=this.$28();if(a){var b=a.scrollHeight;b>0&&!this.$39(a)&&(this.$8=!0,a.scrollTop=b)}};a.prototype.$39=function(a){a=a||this.$28();return!!(a&&a.scrollTop>=a.scrollHeight-a.clientHeight-l)};a.prototype.$29=function(){if(!k.getTabStateIfExists(this.$12)||!this.getPersistentState().isTabRaised)return;k.modifyTabState(this.$12,function(a){a.keepAtBottom=this.$39(),b("ConversationNubUtils").informShouldRecheckTabVisibility(this)}.bind(this));this.$8||this.clearJewelNotifications();this.$8=!1};a.prototype.$32=function(a){if(this.$13===a)return;this.$13=a;this.$13&&this.clearJewelNotifications();b("ConversationNubTabsUpdateEventController").informTabsUpdated()};a.prototype.getIsFocused=function(){return this.$13};a.prototype.getPageID=function(){return this.$15};a.prototype.getHasText=function(){return this.$14};a.prototype.$30=function(){var a=this.getPersistentState();if(!a.isTabRaised)return;a.keepAtBottom&&(this.$38(),this.$7&&clearTimeout(this.$7),this.$7=setTimeout(function(){a.keepAtBottom&&this.$38()}.bind(this),100))};a.prototype.$18=function(a){k.modifyTabState(this.$12,function(b){b.badgeCount=a,this.$21()}.bind(this))};a.prototype.$19=function(a){k.modifyTabState(this.$12,function(b){b.isBlinkingUnread=a,this.$22()}.bind(this))};a.prototype.$21=function(){var a=this.$37();if(!a)return;var c=this.getPersistentState().badgeCount,d=c>0;d?(b("DOM").setContent(a,c),b("CSS").show(a)):(b("CSS").hide(a),b("DOM").setContent(a,c))};a.prototype.$22=function(){if(this.$1){var a=this.getPersistentState().isBlinkingUnread;this.$1&&b("CSS").conditionClass(this.$1,"_53tf",a)}};a.prototype.getRootDOM=function(){return this.$1};a.prototype.getShouldShowIntroNux=function(){return this.$10};a.prototype.getShouldShowHideNux=function(){return this.$11};a.prototype.getTabID=function(){return this.$12};a.prototype.getNotificationPayloadAlertID=function(){return this.getPersistentState().notifAlertID};a.prototype.getNotificationType=function(){return this.getPersistentState().notificationType};a.prototype.setNotificationType=function(a){k.modifyTabState(this.$12,function(b){b.notificationType=a})};a.prototype.getFeedbackTargetID=function(){return this.getPersistentState().ftID};a.prototype.getPermalinkURI=function(){return this.getPersistentState().permalinkURI};a.prototype.getTitle=function(){return this.getPersistentState().title};a.prototype.getBadgeCount=function(){return this.getPersistentState().badgeCount};a.prototype.getIsRaised=function(){return this.getPersistentState().isTabRaised};a.prototype.getSessionID=function(){return this.$5};a.prototype.markCommentsAsSeenWithoutBadging=function(a){k.modifyTabState(this.$12,function(b){a.forEach(function(a){b.allSeenNewComments[a]=!0})})};a.prototype.attemptAddNewCommentsToBadge=function(a){__p&&__p();k.modifyTabState(this.$12,function(b){__p&&__p();a.forEach(function(a){if(b.allSeenNewComments[a])return;b.allSeenNewComments[a]=!0;b.unseenCommentsSinceLastCleared[a]=!0});var c=Object.keys(b.unseenCommentsSinceLastCleared).length;b.hasFakeInitBadge&&(c+=1);var d=b.badgeCount;this.$18(c);this.$19(c>0&&c>d)}.bind(this))};a.prototype.clearBadge=function(){k.clearTabNotifications(this.$12),this.$21(),this.$22()};a.prototype.clearJewelNotifications=function(){var a=this.getNotificationPayloadAlertID();a&&b("NotificationUserActions").markNotificationsAsRead([a])};a.prototype.popOutAndInformTabUpdate=function(){this.popOut(),b("ConversationNubTabsUpdateEventController").informTabsUpdated()};a.prototype.popOut=function(){k.modifyTabState(this.$12,function(a){this.$1&&b("CSS").addClass(this.$1,"_5r93"),a.isTabRaised=!0,this.clearBadge(),a.keepAtBottom&&this.$38()}.bind(this))};a.prototype.minimize=function(){k.modifyTabState(this.$12,function(a){this.$1&&b("CSS").removeClass(this.$1,"_5r93"),a.isTabRaised=!1,this.$2&&this.$2.hideMenu(),this.clearBadge()}.bind(this))};a.prototype.forceReflow=function(){this.$30()};a.prototype.isFormForThisUFI=function(a){return this.$1&&b("containsNode")(this.$1,a)};a.prototype.destroy=function(){this.$6.release(),this.$2&&this.$2.destroy(),this.$2=null,this.$7&&clearTimeout(this.$7),this.minimize(),this.$1&&(b("DOM").remove(this.$1),b("Arbiter").inform("ConversationNub/destroy",{root:this.$1}),this.$1=null)};e.exports=a}),null);
__d("XConversationNubActionTakenController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/conversation/nub_story/action_taken/",{})}),null);
__d("ConversationNubActionTakenReporter",["Arbiter","AsyncRequest","ConversationNubUtils","PinnedConversationNubsActionTaken","SubscriptionsHandler","XConversationNubActionTakenController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.$2=function(event,a){a.tabID;var c=a.ftID;a.tabState;a.sessionID;a=a.reason;(a===b("ConversationNubUtils").CLOSE_REASON_TAB_X_OUT||a===b("ConversationNubUtils").CLOSE_REASON_OVERFLOW_X_OUT||a===b("ConversationNubUtils").CLOSE_REASON_UNPIN)&&this.$3(c,b("PinnedConversationNubsActionTaken").TAB_CLOSED_BY_USER)}.bind(this),this.$1=new(b("SubscriptionsHandler"))(),this.$1.addSubscriptions(b("Arbiter").subscribe(b("ConversationNubUtils").CLOSE_TAB_EVENT,this.$2))}a.prototype.destroy=function(){this.$1.release()};a.prototype.$3=function(a,c){var d=b("XConversationNubActionTakenController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(d).setMethod("POST").setData({ft_id:a,action:c}).setAllowCrossPageTransition(!0).send()};e.exports=a}),null);
__d("ConversationNubHeader",["csx","ArbiterMixin","Bootloader","ConversationNubUtils","DOM","Event","EventListener","Keys","SubscriptionsHandler","ifRequired","mixin"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;function i(a,c){return b("EventListener").listen(a,"keydown",function(a){b("Event").getKeyCode(a)===b("Keys").RETURN&&c(a)})}c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));h=c&&c.prototype;function a(a,c){h.constructor.call(this),this.$ConversationNubHeader6=!1,this.$ConversationNubHeader1=a,this.$ConversationNubHeader3=c,this.$ConversationNubHeader4=null,this.$ConversationNubHeader5=!1,this.$ConversationNubHeader2=new(b("SubscriptionsHandler"))(),this.$ConversationNubHeader7()}a.prototype.$ConversationNubHeader7=function(){var a=this.$ConversationNubHeader1;this.$ConversationNubHeader2.addSubscriptions(b("EventListener").listen(a,"click",this.$ConversationNubHeader8.bind(this)));a=b("ConversationNubUtils").getCloseButtonElem(a);a&&b("ConversationNubUtils").addCloseButtonListeners(a,this.$ConversationNubHeader2,this.$ConversationNubHeader9.bind(this));a=this.$ConversationNubHeader10();a&&this.$ConversationNubHeader2.addSubscriptions(b("EventListener").listen(a,"click",this.$ConversationNubHeader11.bind(this)),i(a,this.$ConversationNubHeader11.bind(this)));a=this.$ConversationNubHeader12();a&&this.$ConversationNubHeader2.addSubscriptions(b("EventListener").listen(a,"click",this.$ConversationNubHeader13.bind(this)),b("EventListener").listen(a,"mouseover",this.$ConversationNubHeader14.bind(this)),b("EventListener").listen(a,"focus",this.$ConversationNubHeader15.bind(this)),i(a,this.$ConversationNubHeader16.bind(this)))};a.prototype.$ConversationNubHeader12=function(){return b("DOM").scry(this.$ConversationNubHeader1,"._1rf1")[0]};a.prototype.$ConversationNubHeader10=function(){return b("DOM").scry(this.$ConversationNubHeader1,"._4a56")[0]};a.prototype.$ConversationNubHeader17=function(){return b("ConversationNubUtils").getCloseButtonElem(this.$ConversationNubHeader1)};a.prototype.$ConversationNubHeader9=function(){this.inform("closeButton")};a.prototype.$ConversationNubHeader11=function(a){a.type==="click"&&a.kill(),this.inform("minimizeButton")};a.prototype.$ConversationNubHeader8=function(){this.inform("clickHeader")};a.prototype.$ConversationNubHeader18=function(){this.inform("showMenu")};a.prototype.$ConversationNubHeader19=function(){this.inform("hideMenu");var a=this.$ConversationNubHeader12();a&&a.blur()};a.prototype.$ConversationNubHeader20=function(){this.inform("menuPermalinkClick")};a.prototype.$ConversationNubHeader21=function(a){__p&&__p();if(this.$ConversationNubHeader4)return;var c=this.$ConversationNubHeader12();if(!c)return;a&&(this.$ConversationNubHeader5=!0);b("Bootloader").loadModules(["React","ReactDOM","ConversationNubHeaderMenu.react"],function(a,b,d){if(this.$ConversationNubHeader6)return;var e=babelHelpers["extends"]({},this.$ConversationNubHeader3(),{onMenuShow:this.$ConversationNubHeader18.bind(this),onMenuHide:this.$ConversationNubHeader19.bind(this),onPermalinkClick:this.$ConversationNubHeader20.bind(this),showOnMount:this.$ConversationNubHeader5});this.$ConversationNubHeader4=b.render(a.createElement(d,e),c)}.bind(this),"ConversationNubHeader")};a.prototype.$ConversationNubHeader13=function(a){a.kill(),this.$ConversationNubHeader21(!0)};a.prototype.$ConversationNubHeader14=function(){this.$ConversationNubHeader21(!1)};a.prototype.$ConversationNubHeader15=function(){this.$ConversationNubHeader21(!1)};a.prototype.$ConversationNubHeader16=function(){this.$ConversationNubHeader4?this.$ConversationNubHeader4.toggle():this.$ConversationNubHeader21(!0)};a.prototype.hideMenu=function(){this.$ConversationNubHeader4&&this.$ConversationNubHeader4.hide()};a.prototype.destroy=function(){this.$ConversationNubHeader6=!0;var a=this.$ConversationNubHeader12();a&&this.$ConversationNubHeader4&&b("ifRequired")("ReactDOM",function(b){b.unmountComponentAtNode(a)});this.$ConversationNubHeader2.release()};e.exports=a}),null);
__d("ConversationNubTabsUpdateEventController",["Arbiter","ConversationNubUtils"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="ConversationNub/tabsUpdated",h="ConversationNub/minimizedByUser",i="ConversationNub/maximizedByUser",j=!1;function k(a){j||b("Arbiter").inform(g,a)}function a(a){return b("Arbiter").subscribe(g,function(b,c){j=!0,a(c),j=!1})}function c(a,c){c&&b("Arbiter").inform(h,{tab:a}),a.minimize(),k()}function d(a,c){if(!c&&!b("ConversationNubUtils").allowProgrammaticPopOut())return;c&&b("Arbiter").inform(i,{tab:a});a.popOut();k()}e.exports={TAB_MINIMIZED_BY_USER_EVENT:h,TAB_MAXIMIZED_BY_USER_EVENT:i,informTabsUpdated:k,subscribeToTabsUpdated:a,minimizeAndInformTabUpdate:c,popOutAndInformTabUpdate:d}}),null);
__d("XConversationNubTogglePinController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/conversation/nub_story/toggle_pin/",{ft_id:{type:"String"},pin:{type:"Bool",defaultValue:!1},with_render:{type:"Bool",defaultValue:!1},notif_setting:{type:"Enum",enumType:1}})}),null);
__d("XConversationsToggleController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/conversation/toggle_feature/",{turn_conversations_on:{type:"Bool",defaultValue:!1}})}),null);
__d("isBusinessURI",["isFacebookURI"],(function(a,b,c,d,e,f){"use strict";function a(a){return b("isFacebookURI")(a)&&a.getSubdomain()==="business"}e.exports=a}),null);
__d("isGamesURI",["isFacebookURI"],(function(a,b,c,d,e,f){"use strict";function a(a){return b("isFacebookURI")(a)&&a.getPath().startsWith("/games")}e.exports=a}),null);
__d("ConversationNubUtils",["csx","Arbiter","AsyncRequest","ConversationNubTabState","DOM","Event","EventListener","Keys","NotificationConversationController","URI","XConversationNubTogglePinController","XConversationsToggleController","isBusinessURI","isCanvasAppURI","isGamesURI"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("ConversationNubTabState"),i=Object.freeze({DISABLE:"disable",ENABLE:"enable"}),j="ConversationNubUtils/closeTab",k="ConversationNubUtils/unpinnedFromHeader",l="ConversationNubUtils/recheckTabVisibility",m="ConversationNubUtils/openPermalinkFromHeader",n="ConversationNubUtils/turnOff",o="ConversationNubUtils/turnOn",p="tab-x-out",q="browser-tab-sync",r="overflow-x-out",s="unpin";function a(a){var b=Object.values(i);return b.find(function(b){return b===a})||null}function t(a,c,d,e){e=e||{};e=e.notif_setting;a=b("XConversationNubTogglePinController").getURIBuilder().setString("ft_id",String(a)).setBool("pin",c);e&&a.setEnum("notif_setting",e);c=a.getURI();e=new(b("AsyncRequest"))().setURI(c).setMethod("POST");d&&e.setAllowCrossPageTransition(!0);e.send()}function u(a){var c=b("XConversationsToggleController").getURIBuilder().setBool("turn_conversations_on",a).getURI();a?H():G();c=new(b("AsyncRequest"))().setURI(c).setAllowCrossPageTransition(!0).setHandler(function(a){a.getPayload().conversationsStatus?H():G()}).setErrorHandler(function(b){a?G():H()}).setMethod("POST");c.send()}function v(a,b,c){t(a,!0,b,c)}function w(a,b,c){t(a,!1,b,c)}function c(a,b){v(a,!1,b)}function d(a,b){w(a,!1,b)}function f(a,b){v(a,!0,b)}function g(a,b){w(a,!0,b)}function x(){u(!1),b("NotificationConversationController").deleteAllTabs()}function y(){u(!0)}function z(a){return b("DOM").scry(a,"._4iz6")[0]}function A(a,c,d){var e=function(){d()};c.addSubscriptions(b("EventListener").listen(a,"click",e),b("EventListener").listen(a,"keydown",function(a){b("Event").getKeyCode(a)===b("Keys").RETURN&&e()}))}function B(){var a=b("URI").getRequestURI();return!b("isCanvasAppURI")(a)&&!b("isBusinessURI")(a)&&!b("isGamesURI")(a)}function C(a,c,d){var e=h.getLoadedTab(a);if(!e)return;var f=e.getPersistentState(),g=e.getSessionID();e=e.getPageID();b("Arbiter").inform(j,{tabID:a,ftID:c,tabState:f,sessionID:g,reason:d,pageID:e})}function D(a){a=h.getLoadedTab(a);if(!a)return;b("Arbiter").inform(k,{tab:a})}function E(a){b("Arbiter").inform(l,{tab:a})}function F(a){a=h.getLoadedTab(a);if(!a)return;b("Arbiter").inform(m,{tab:a})}function G(){b("Arbiter").inform(n,{})}function H(){b("Arbiter").inform(o,{})}e.exports={CLOSE_TAB_EVENT:j,UNPIN_FROM_HEADER_EVENT:k,OPEN_PERMALINK_FROM_HEADER_EVENT:m,TURN_CONVERSATIONS_OFF_EVENT:n,TURN_CONVERSATIONS_ON_EVENT:o,CLOSE_REASON_TAB_X_OUT:p,CLOSE_REASON_SYNCHRONIZED_FROM_OTHER_TAB:q,CLOSE_REASON_OVERFLOW_X_OUT:r,CLOSE_REASON_UNPIN:s,coerceToPinRequestNotifSetting:a,sendPinRequest:c,sendUnpinRequest:d,sendPinRequestAcrossTransitions:f,sendUnpinRequestAcrossTransitions:g,getCloseButtonElem:z,addCloseButtonListeners:A,informShouldCloseTab:C,informDidUnpinFromHeaderMenu:D,informShouldRecheckTabVisibility:E,informOpenPermalinkFromHeader:F,allowProgrammaticPopOut:B,turnConversationsOff:x,turnConversationsOn:y}}),null);
__d("ConversationNubPermalinkUtils",["URI","isFacebookURI"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){return a.substr(-1)==="/"?a.slice(0,-1):a}function h(a,b){a=a.getPath();b=b.getPath();return g(a)===g(b)}function i(a,b,c){a=a.getQueryData();b=b.getQueryData();a=a[c];b=b[c];return a==null&&b==null?!0:a===b}function a(a){var c=new(b("URI"))(window.location.href);return c&&a&&b("isFacebookURI")(c)&&b("isFacebookURI")(a)&&h(c,a)&&i(c,a,"fbid")&&i(c,a,"story_fbid")}e.exports={isOnPermalink:a}}),null);
__d("ConversationNubViewportManager",["DockTabsViewportCalculator","DockTabsViewportPinnedConversationTabUtils"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("DockTabsViewportPinnedConversationTabUtils").getMinRequiredWidthForFirstConvoTab;function a(a,c,d){this.$1=a,this.$3=c,this.$2=b("DockTabsViewportCalculator").getInstance(this.$1),this.$2&&this.$2.registerPinnedConvoTabCallbacks(babelHelpers["extends"]({},d,{pinnedConvoTabStateGetter:function(){return this.$3}.bind(this)}))}a.prototype.getNumDockTabsToShow=function(a){return this.getCouldFitAtLeastOneDockTab(a)?1:0};a.prototype.getCouldFitAtLeastOneDockTab=function(a){var b=g();return b<=a};a.prototype.forceRecalculatePinnedConvoTabs=function(a){this.$2&&this.$2.forceRecalculatePinnedConvoTabs(a)};e.exports=a}),null);
__d("ConversationNubVisibilityDedupeUtils",["Bootloader","emptyFunction","ifRequired"],(function(a,b,c,d,e,f){"use strict";function a(a){b("Bootloader").loadModules(["UFICommentVisibilityStore"],a,"ConversationNubVisibilityDedupeUtils")}function c(a){return b("ifRequired")("UFICommentVisibilityStore",function(b){return b.isFeedbackTargetVisible(a)},b("emptyFunction").thatReturnsFalse)}e.exports={bootloadUFIVisibilityModule:a,isFeedbackTargetVisible:c}}),null);
__d("XNotificationNubStoryController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/conversation/nub_story/",{notif_alert_id:{type:"String"},notif_id:{type:"Int"},ft_id:{type:"String"},force_minimized:{type:"Bool",defaultValue:!1}})}),null);
__d("NotificationConversationController",["csx","cx","Arbiter","AsyncRequest","Bootloader","ConversationNub","ConversationNubActionTakenReporter","ConversationNubPermalinkUtils","ConversationNubTabState","ConversationNubTabsUpdateEventController","ConversationNubUtils","ConversationNubViewportManager","ConversationNubVisibilityDedupeUtils","CSS","DOM","PinnedConversationNubsConfig","SubscriptionsHandler","URI","XNotificationNubStoryController","ge","ifRequired","nullthrows"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=b("ConversationNubVisibilityDedupeUtils").isFeedbackTargetVisible,j=1,k=b("ConversationNubTabState"),l=Object.create(null),m=null,n=null,o=null,p=null,q=null,r=null,s=!1,t=null,u=null,v=null,w=null,x=Object.create(null);function y(){n||(n=b("DOM").scry(b("ge")("pagelet_dock"),"._1mw-")[0]);return n}function z(){if(!o){var a=y();a&&(o=b("DOM").scry(a,"._1tvj")[0])}return o}function A(){if(!p){var a=y();a&&(p=b("DOM").scry(a,"._2ikx .fbNubButton")[0])}return p}a.prototype.init=function(){__p&&__p();if(s)return;s=!0;var a=new(b("SubscriptionsHandler"))();a.addSubscriptions(b("ConversationNubTabsUpdateEventController").subscribeToTabsUpdated(this.$2.bind(this)),b("Arbiter").subscribe(b("ConversationNubUtils").CLOSE_TAB_EVENT,function(a,b){a=b||{};b=a.tabID;b&&this.$3(b)}.bind(this)));this.$1=new(b("ConversationNubActionTakenReporter"))();t=a};a.prototype.$4=function(a){a=m?m.getNumDockTabsToShow(a):j;k.setMaxDockTabs(a)};a.prototype.$5=function(a,c){this.$4(a);if(c){var d=c.tabToPromote;c=c.tabToOpenIfInDock;d&&!k.isTabInDock(d.getTabID())&&k.moveTabToDockLeft(d.getTabID());b("ConversationNubUtils").allowProgrammaticPopOut()&&c&&k.isTabInDock(c.getTabID())&&c.popOut()}this.$6(a)};a.prototype.$2=function(a){m&&m.forceRecalculatePinnedConvoTabs(a)};a.prototype.$6=function(a){__p&&__p();var c=k.getTotalTabCount(),d=k.getNumDockTabs();a=m?m.getCouldFitAtLeastOneDockTab(a):!1;a=c>0&&a;d=d<c&&a;c=y();c&&(b("CSS").conditionClass(c,"_1tvf",a),b("CSS").conditionClass(c,"_1dex",d),b("CSS").conditionClass(c,"_1tvi",d));a=b("PinnedConversationNubsConfig").pinnedToLeft?k.getTabsForDockOldestFirst():k.getTabsForDockNewestFirst();a.forEach(function(a){a.getIsRaised()&&a.clearBadge()});c=k.getTabsForMenuNewestFirst();this.$7(a);this.$8(c)};a.prototype.handleNotificationsRead=function(a){this.init();k.getUnsortedLoadedTabs().forEach(function(b){var c=b.getNotificationPayloadAlertID();c&&a[c]&&b.clearBadge()});k.getUnloadedTabs().forEach(function(b){b.notifAlertID&&a[b.notifAlertID]&&k.clearTabNotifications(b.tabID)});var b=k.getTabsForMenuNewestFirst();this.$8(b)};a.prototype.handleNewNotificationFromGraphQL=function(a,c){this.init();a=b("nullthrows")(a);var d=a.tab_id,e=a.notification,f=a.feedback_target_id;a=a.permalink_uri;e=b("nullthrows")(e);var g=e.notif_id,h=e.alert_id;e=e.notif_type;this.$9(b("nullthrows")(d),b("nullthrows")(g),b("nullthrows")(f),b("nullthrows")(h),a?new(b("URI"))(a):null,c,e)};a.prototype.$9=function(a,c,d,e,f,g,h){e=b("XNotificationNubStoryController").getURIBuilder().setString("notif_alert_id",e).setInt("notif_id",c);this.$10(d,g);this.$11(a,d,h,f,e)};a.prototype.$10=function(a,b){x[a]||(x[a]=b)};a.prototype.$11=function(a,c,d,e,f){__p&&__p();if(l[a])return;var g=k.getLoadedTab(a);if(g){d&&g.setNotificationType(d);return}(b("ConversationNubPermalinkUtils").isOnPermalink(e)||i(c))&&f.setBool("force_minimized",!0);l[a]=!0;new(b("AsyncRequest"))().setURI(f.getURI()).setAllowCrossPageTransition(!0).setFinallyHandler(function(){delete l[a]}).send()};a.prototype.$12=function(a){__p&&__p();var c=!0;k.getUnsortedLoadedTabs().forEach(function(b){var d=b.getFeedbackTargetID(),e=a[d];e=e?Object.keys(e):[];if(e.length){var f=b.getBadgeCount();i(d)?(b.markCommentsAsSeenWithoutBadging(e),b.clearBadge()):b.attemptAddNewCommentsToBadge(e);d=b.getBadgeCount();f!==d&&(c=!0)}});c&&b("ConversationNubTabsUpdateEventController").informTabsUpdated()};a.prototype.$13=function(a){if(w)return;b("Bootloader").loadModules(["ConversationNubSurveys"],function(b){w||(w=new b(a))},"NotificationConversationController")};a.prototype.$14=function(a,c,d){if(v){v.addTab(a,d);delete x[a.getPersistentState().ftID];return}b("Bootloader").loadModules(["ConversationNubLogger"],function(b){v||(v=new b(c)),v.addTab(a,d),delete x[a.getPersistentState().ftID]},"NotificationConversationController")};a.prototype.$15=function(){if(u)return;b("Bootloader").loadModules(["ConversationNubUFICentralUpdateManager"],function(a){if(u)return;u=new a(this.$12.bind(this))}.bind(this),"NotificationConversationController")};a.prototype.$7=function(a){var c=z();if(!c)return;b("Bootloader").loadModules(["React","ReactDOM","ConversationNubDockedTabGroup.react"],function(b,d,e){r=d.render(b.createElement(e,{dockTabs:a}),c)},"NotificationConversationController")};a.prototype.$16=function(a){a.popOut(),b("ConversationNubTabsUpdateEventController").informTabsUpdated({tabToPromote:a})};a.prototype.$8=function(a){var c=A();if(!c)return;b("Bootloader").loadModules(["React","ReactDOM","ConversationNubCollapsedSelectorMenu.react"],function(b,d,e){q=d.render(b.createElement(e,{menuTabs:a,onTabSelected:this.$16}),c)}.bind(this),"NotificationConversationController")};a.prototype.$17=function(){if(!m){var a=y();if(a){var c={onAvailableWidthChanged:this.$5.bind(this)};m=new(b("ConversationNubViewportManager"))(a,k,c)}}};a.prototype.storyFromServer=function(a,c){__p&&__p();s||this.init();var d=c.attempt_open_on_init,e=c.ft_id,f=c.init_without_badge,g=c.notif_alert_id,h=c.notification_type,j=c.permalink_uri,l=c.promote_on_init,m=c.tab_add_source,n=c.tab_id,o=c.title,p=c.should_show_intro_nux,q=c.should_show_hide_nux;c=c.page_id;var r=k.getLoadedTab(n);if(r){(l||d)&&b("ConversationNubTabsUpdateEventController").informTabsUpdated({tabToPromote:l?r:null,tabToOpenIfInDock:d?r:null});return}f=f||i(e);r=k.getTabStateIfExists(n);if(r)f=null;else{r=b("ConversationNub").createDefaultState(n,j,e,g,h,o);k.addTabState(r)}j=new(b("ConversationNub"))(a,n,f,c,Boolean(p),Boolean(q));k.addLoadedTab(n,j);d=d||j.getPersistentState().isTabRaised;this.$15();this.$17();b("ConversationNubTabsUpdateEventController").informTabsUpdated({tabToPromote:l?j:null,tabToOpenIfInDock:d?j:null});this.$13(k);g=x[e]||m||"unknown";this.$14(j,k,g)};a.prototype.deleteAllTabs=function(){k.deleteAllTabs(),b("ConversationNubTabsUpdateEventController").informTabsUpdated()};a.prototype.$3=function(a){a=k.deleteTab(a);a&&b("ConversationNubTabsUpdateEventController").informTabsUpdated()};a.prototype.unsubscribe=function(){t&&t.release(),t=null,v&&v.destroy(),v=null,w&&w.destroy(),w=null,u&&u.destroy(),u=null,this.$1.destroy(),b("ifRequired")("ReactDOM",function(a){var b=A();q&&b&&a.unmountComponentAtNode(b);b=z();r&&b&&a.unmountComponentAtNode(b)})};function a(){}e.exports=new a()}),null);
__d("PinnedConversationTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:PinnedConversationLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:PinnedConversationLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:PinnedConversationLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAttemptOpenOnInit=function(a){this.$1.attempt_open_on_init=a;return this};a.prototype.setBadgeCount=function(a){this.$1.badge_count=a;return this};a.prototype.setClientEventTimeMs=function(a){this.$1.client_event_time_ms=a;return this};a.prototype.setEvent=function(a){this.$1.event=a;return this};a.prototype.setFtID=function(a){this.$1.ft_id=a;return this};a.prototype.setIsRaised=function(a){this.$1.is_raised=a;return this};a.prototype.setNotificationType=function(a){this.$1.notification_type=a;return this};a.prototype.setPageID=function(a){this.$1.page_id=a;return this};a.prototype.setPromoteOnInit=function(a){this.$1.promote_on_init=a;return this};a.prototype.setReason=function(a){this.$1.reason=a;return this};a.prototype.setTabID=function(a){this.$1.tab_id=a;return this};a.prototype.setTabSessionID=function(a){this.$1.tab_session_id=a;return this};a.prototype.setTabsInDock=function(a){this.$1.tabs_in_dock=a;return this};a.prototype.setTabsInMenu=function(a){this.$1.tabs_in_menu=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};a.prototype.setWindowInnerHeight=function(a){this.$1.window_inner_height=a;return this};a.prototype.setWindowInnerWidth=function(a){this.$1.window_inner_width=a;return this};c={attempt_open_on_init:!0,badge_count:!0,client_event_time_ms:!0,event:!0,ft_id:!0,is_raised:!0,notification_type:!0,page_id:!0,promote_on_init:!0,reason:!0,tab_id:!0,tab_session_id:!0,tabs_in_dock:!0,tabs_in_menu:!0,vc:!0,window_inner_height:!0,window_inner_width:!0};e.exports=a}),null);
__d("ConversationNubLogger",["Arbiter","ConversationNubTabsUpdateEventController","ConversationNubUtils","PinnedConversationTypedLogger","SubscriptionsHandler"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=new(b("SubscriptionsHandler"))(),this.$2=a,this.$3()}a.prototype.$3=function(){__p&&__p();this.$1.addSubscriptions(b("Arbiter").subscribe(b("ConversationNubUtils").CLOSE_TAB_EVENT,function(a,c){a=c.tabState;var d=c.sessionID;c=c.reason;c=new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_tab_close").setReason(c);this.$4(c,a,d)}.bind(this))),this.$1.addSubscriptions(b("Arbiter").subscribe(b("ConversationNubUtils").UNPIN_FROM_HEADER_EVENT,function(a,c){a=c.tab;c=new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_tab_hide");this.$5(c,a)}.bind(this))),this.$1.addSubscriptions(b("Arbiter").subscribe(b("ConversationNubTabsUpdateEventController").TAB_MAXIMIZED_BY_USER_EVENT,function(a,c){a=c.tab;c=new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_tab_maximize");this.$5(c,a)}.bind(this))),this.$1.addSubscriptions(b("Arbiter").subscribe(b("ConversationNubTabsUpdateEventController").TAB_MINIMIZED_BY_USER_EVENT,function(a,c){a=c.tab;c=new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_tab_minimize");this.$5(c,a)}.bind(this))),this.$1.addSubscriptions(b("Arbiter").subscribe(b("ConversationNubUtils").OPEN_PERMALINK_FROM_HEADER_EVENT,function(a,c){a=c.tab;c=new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_open_permalink_from_header");this.$5(c,a)}.bind(this)))};a.prototype.$5=function(a,b){a.setTabID(b.getTabID()).setPageID(b.getPageID()).setClientEventTimeMs(Date.now()).setTabsInMenu(this.$2.getNumMenuTabs()).setTabsInDock(this.$2.getNumDockTabs()).setWindowInnerWidth(window.innerWidth).setWindowInnerHeight(window.innerHeight);a.setFtID(b.getFeedbackTargetID()).setIsRaised(b.getIsRaised()).setBadgeCount(b.getBadgeCount()).setTabSessionID(b.getSessionID());b=b.getNotificationType();b&&a.setNotificationType(b);a.log()};a.prototype.$4=function(a,b,c){a.setTabID(b.tabID).setClientEventTimeMs(Date.now()).setTabsInMenu(this.$2.getNumMenuTabs()).setTabsInDock(this.$2.getNumDockTabs()).setWindowInnerWidth(window.innerWidth).setWindowInnerHeight(window.innerHeight),a.setFtID(b.ftID).setIsRaised(b.isTabRaised).setBadgeCount(b.badgeCount).setTabSessionID(c),b.notificationType&&a.setNotificationType(b.notificationType),a.log()};a.subscriptionTriggered=function(a){new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_subscription_triggered").setReason(a).log()};a.prototype.addTab=function(a,c){c=new(b("PinnedConversationTypedLogger"))().setEvent("pinned_conversation_tab_add").setReason(c);this.$5(c,a)};a.prototype.destroy=function(){this.$1.release()};e.exports=a}),null);
__d("ConversationNotificationListeners",["Bootloader","ConversationNubAddTabSource","ConversationNubLogger","FacebookWebNotificationsSubscription","NotificationConstants","NotificationUpdates","once"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("NotificationConstants").PayloadSourceType.LIVE_SEND;function h(){b("NotificationUpdates").subscribe("update-notifications",function(a,c){c.payloadsource===g&&c.readState&&Object.keys(c.readState).length&&b("Bootloader").loadModules(["NotificationConversationController"],function(a){a.handleNotificationsRead(c.readState)},"ConversationNotificationListeners")})}var i=b("once")(function(){h(),b("FacebookWebNotificationsSubscription").subscribe({event:"NEW_PINNED_CONVERSATION",callback:function(a){b("ConversationNubLogger").subscriptionTriggered("graphql"),b("Bootloader").loadModules(["NotificationConversationController"],function(c){c.handleNewNotificationFromGraphQL(a,b("ConversationNubAddTabSource").NOTIFICATION)},"ConversationNotificationListeners")}})});e.exports={initialize:function(){i()}}}),null);